<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Historial Personal</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="confirmarCerrarSesion()" color="light">
        ğŸ‘‹ Cerrar SesiÃ³n
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding" *ngIf="madreActual">
  <!-- BIENVENIDA -->
  <ion-card color="secondary">
    <ion-card-content class="ion-text-center">
      <h1>ğŸ‘‹ Hola, {{ madreActual.nombre }}</h1>
      <p>Tu bienestar y el de tu bebÃ© son nuestra prioridad</p>
    </ion-card-content>
  </ion-card>

  <!-- INFORMACIÃ“N PRINCIPAL -->
  <ion-grid>
    <ion-row>
      <!-- COLUMNA IZQUIERDA: INFORMACIÃ“N PERSONAL -->
      <ion-col size="12" size-md="6">
        <!-- DATOS PERSONALES -->
        <ion-card>
          <ion-card-header>
            <ion-card-title>ğŸ‘¤ Mis Datos</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-list>
              <ion-item>
                <ion-label>
                  <h3>ğŸ“ TelÃ©fono</h3>
                  <p>{{ madreActual.telefono }}</p>
                </ion-label>
              </ion-item>
              <ion-item>
                <ion-label>
                  <h3>ğŸ‚ Edad</h3>
                  <p>{{ madreActual.edad }} aÃ±os</p>
                </ion-label>
              </ion-item>
              <ion-item>
                <ion-label>
                  <h3>ğŸ¤° Semanas de gestaciÃ³n</h3>
                  <p>{{ madreActual.semanaGestacion }} semanas</p>
                </ion-label>
              </ion-item>
              <ion-item>
                <ion-label>
                  <h3>ğŸ“… Trimestre actual</h3>
                  <p>{{ trimestreActual }}</p>
                </ion-label>
              </ion-item>
              <ion-item>
                <ion-label>
                  <h3>ğŸ©¸ Grupo sanguÃ­neo</h3>
                  <p>{{ madreActual.grupoSanguineo || 'No especificado' }}</p>
                </ion-label>
              </ion-item>
            </ion-list>
          </ion-card-content>
        </ion-card>

        <!-- INFORMACIÃ“N MÃ‰DICA -->
        <ion-card>
          <ion-card-header>
            <ion-card-title>ğŸ¥ InformaciÃ³n MÃ©dica</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-item>
              <ion-label>
                <h3>ğŸ’“ PresiÃ³n arterial</h3>
                <p>{{ madreActual.presionArterial || 'No registrada' }}</p>
              </ion-label>
            </ion-item>
            <ion-item>
              <ion-label class="ion-text-wrap">
                <h3>âš ï¸ Alergias</h3>
                <p>{{ madreActual.alergias || 'Ninguna registrada' }}</p>
              </ion-label>
            </ion-item>
            <ion-item>
              <ion-label class="ion-text-wrap">
                <h3>ğŸ—ï¸ Enfermedades crÃ³nicas</h3>
                <p>{{ madreActual.enfermedadesCronicas || 'Ninguna registrada' }}</p>
              </ion-label>
            </ion-item>
          </ion-card-content>
        </ion-card>
      </ion-col>

      <!-- COLUMNA DERECHA: FPP Y ALERTAS -->
      <ion-col size="12" size-md="6">
        <!-- FECHA PROBABLE DE PARTO -->
        <ion-card color="warning">
          <ion-card-header>
            <ion-card-title>ğŸ“… Fecha Probable de Parto</ion-card-title>
          </ion-card-header>
          <ion-card-content class="ion-text-center">
            <h2>{{ madreActual.fpp }}</h2>
            <p *ngIf="diasRestantesFPP > 0">
              Faltan <strong>{{ diasRestantesFPP }} dÃ­as</strong>
            </p>
            <p *ngIf="diasRestantesFPP <= 0">
              <strong>Â¡Tu bebÃ© estÃ¡ por llegar!</strong>
            </p>
          </ion-card-content>
        </ion-card>

        <!-- ALERTAS MÃ‰DICAS -->
        <ion-card>
          <ion-card-header>
            <ion-card-title>âš ï¸ Mis Alertas</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <div *ngIf="madreActual.alertas.length === 0" class="ion-text-center">
              <p>ğŸ‰ No tienes alertas mÃ©dicas</p>
              <p><small>Tu embarazo progresa normalmente</small></p>
            </div>
            <div *ngIf="madreActual.alertas.length > 0">
              <ion-item *ngFor="let alerta of madreActual.alertas" class="ion-margin-bottom">
                <ion-label class="ion-text-wrap">
                  <ion-badge [color]="obtenerColorAlerta(madreActual.alertas.length)">
                    {{ alerta }}
                  </ion-badge>
                  <p><small>Consulta con tu mÃ©dico</small></p>
                </ion-label>
              </ion-item>
            </div>
          </ion-card-content>
        </ion-card>

        <!-- MÃ‰DICO ASIGNADO -->
        <ion-card>
          <ion-card-header>
            <ion-card-title>ğŸ©º Mi MÃ©dico</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-list>
              <ion-item>
                <ion-label>
                  <h3>ğŸ‘¨â€âš•ï¸ Nombre</h3>
                  <p>{{ datosMedico.nombre }}</p>
                </ion-label>
              </ion-item>
              <ion-item>
                <ion-label>
                  <h3>ğŸ“ Especialidad</h3>
                  <p>{{ datosMedico.especialidad }}</p>
                </ion-label>
              </ion-item>
              <ion-item>
                <ion-label>
                  <h3>ğŸ“ TelÃ©fono</h3>
                  <p>{{ datosMedico.telefono }}</p>
                </ion-label>
              </ion-item>
              <ion-item>
                <ion-label class="ion-text-wrap">
                  <h3>ğŸ¥ Consultorio</h3>
                  <p>{{ datosMedico.consultorio }}</p>
                </ion-label>
              </ion-item>
            </ion-list>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>

    <!-- PRÃ“XIMOS CONTROLES -->
    <ion-row>
      <ion-col size="12">
        <ion-card>
          <ion-card-header>
            <ion-card-title>ğŸ“‹ Mis PrÃ³ximos Controles</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-list>
              <ion-item *ngFor="let control of proximosControles">
                <ion-label>
                  <h3>{{ control.tipo }}</h3>
                  <p>ğŸ“… {{ formatearFecha(control.fecha) }}</p>
                  <p>ğŸ“ {{ control.lugar }}</p>
                </ion-label>
                <ion-button fill="outline" size="small">
                  ğŸ—“ï¸ Agendar
                </ion-button>
              </ion-item>
            </ion-list>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>

    <!-- RECOMENDACIONES -->
    <ion-row>
      <ion-col size="12">
        <ion-card color="light">
          <ion-card-header>
            <ion-card-title>ğŸ’¡ Recomendaciones para Ti</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-grid>
              <ion-row>
                <ion-col size="12" size-md="6" *ngFor="let recomendacion of recomendaciones">
                  <ion-item>
                    <ion-label class="ion-text-wrap">
                      {{ recomendacion }}
                    </ion-label>
                  </ion-item>
                </ion-col>
              </ion-row>
            </ion-grid>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

  <!-- ALERTA DE CERRAR SESIÃ“N -->
  <ion-alert
    [isOpen]="mostrarAlertaCerrarSesion"
    header="Cerrar SesiÃ³n"
    message="Â¿EstÃ¡s segura de que quieres cerrar sesiÃ³n?"
    [buttons]="alertaButtons">
  </ion-alert>
</ion-content>

<!-- MENSAJE SI NO HAY DATOS -->
<ion-content class="ion-padding" *ngIf="!madreActual">
  <div class="ion-text-center ion-padding">
    <h2>ğŸ”’ Acceso no autorizado</h2>
    <p>Por favor inicia sesiÃ³n para ver tu historial personal</p>
    <ion-button [routerLink]="['/login-madre']" class="ion-margin-top">
      ğŸ‘© Iniciar SesiÃ³n
    </ion-button>
  </div>
</ion-content>
