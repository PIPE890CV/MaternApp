<ion-header>
  <ion-toolbar color="primary">
    <ion-title>GestiÃ³n de Pacientes</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <!-- ESTADÃSTICAS -->
  <ion-card color="light">
    <ion-card-header>
      <ion-card-title>ğŸ“Š Resumen de Pacientes</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-grid>
        <ion-row>
          <ion-col size="6">
            <h3>{{ totalPacientes }}</h3>
            <p><small>Total Registrados</small></p>
          </ion-col>
          <ion-col size="6">
            <h3>{{ pacientesConAlertas }}</h3>
            <p><small>Con Alertas Activas</small></p>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card-content>
  </ion-card>

  <!-- FILTROS AVANZADOS -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>ğŸ” Filtros Avanzados</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-grid>
        <ion-row>
          <ion-col size="12" size-md="6">
            <ion-searchbar 
              [(ngModel)]="busqueda" 
              (ionInput)="aplicarFiltros()"
              placeholder="Buscar por nombre, telÃ©fono o grupo sanguÃ­neo">
            </ion-searchbar>
          </ion-col>
        </ion-row>
        
        <ion-row>
          <ion-col size="12" size-md="4">
            <ion-item>
              <ion-label>Estado de Alertas</ion-label>
              <ion-select 
                [(ngModel)]="filtroAlerta" 
                (ionChange)="aplicarFiltros()">
                <ion-select-option value="todos">Todos los estados</ion-select-option>
                <ion-select-option value="con-alertas">Con alertas</ion-select-option>
                <ion-select-option value="sin-alertas">Sin alertas</ion-select-option>
              </ion-select>
            </ion-item>
          </ion-col>

          <ion-col size="12" size-md="4">
            <ion-item>
              <ion-label>Rango de Edad</ion-label>
              <ion-select 
                [(ngModel)]="filtroEdad" 
                (ionChange)="aplicarFiltros()">
                <ion-select-option value="todos">Todas las edades</ion-select-option>
                <ion-select-option value="menor-20">Menor de 20</ion-select-option>
                <ion-select-option value="20-35">20 - 35 aÃ±os</ion-select-option>
                <ion-select-option value="mayor-35">Mayor de 35</ion-select-option>
              </ion-select>
            </ion-item>
          </ion-col>

          <ion-col size="12" size-md="4">
            <ion-item>
              <ion-label>Trimestre</ion-label>
              <ion-select 
                [(ngModel)]="filtroSemanas" 
                (ionChange)="aplicarFiltros()">
                <ion-select-option value="todos">Todos los trimestres</ion-select-option>
                <ion-select-option value="primer-trimestre">1er Trimestre</ion-select-option>
                <ion-select-option value="segundo-trimestre">2do Trimestre</ion-select-option>
                <ion-select-option value="tercer-trimestre">3er Trimestre</ion-select-option>
              </ion-select>
            </ion-item>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card-content>
  </ion-card>

  <!-- LISTA DE PACIENTES -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>
        ğŸ‘¥ Lista de Pacientes 
        <ion-badge color="primary" class="ion-margin-start">
          {{ pacientesFiltrados.length }}
        </ion-badge>
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div *ngIf="pacientesFiltrados.length === 0" class="ion-text-center ion-padding">
        <h3>ğŸ” No se encontraron pacientes</h3>
        <p>Intenta ajustar los filtros de bÃºsqueda</p>
      </div>

      <ion-list>
        <ion-item *ngFor="let madre of pacientesFiltrados" class="ion-margin-bottom item-paciente">
          <ion-label class="ion-text-wrap">
            <h2>{{ madre.nombre }}</h2>
            
            <p>ğŸ“ {{ madre.telefono }} â€¢ ğŸ‚ {{ madre.edad }} aÃ±os</p>
            <p>ğŸ¤° {{ madre.semanaGestacion }} semanas â€¢ ğŸ—“ï¸ FPP: {{ madre.fpp }}</p>
            
            <ion-note *ngIf="madre.grupoSanguineo">
              ğŸ©¸ Grupo: {{ madre.grupoSanguineo }}
            </ion-note>
            <br>
            <ion-note *ngIf="madre.presionArterial">
              ğŸ’“ PresiÃ³n: {{ madre.presionArterial }}
            </ion-note>

            <div *ngIf="madre.alertas.length > 0" class="ion-margin-top">
              <ion-badge 
                *ngFor="let alerta of madre.alertas" 
                [color]="obtenerColorAlerta(madre.alertas.length)"
                class="ion-margin-end ion-margin-bottom">
                âš ï¸ {{ alerta }}
              </ion-badge>
            </div>

            <div *ngIf="madre.alertas.length === 0" class="ion-margin-top">
              <ion-badge color="success">
                âœ… Sin alertas
              </ion-badge>
            </div>

            <p class="ion-margin-top">
              <small>ğŸ“… Registrada: {{ madre.fechaRegistro | date:'medium' }}</small>
            </p>
          </ion-label>

          <div slot="end" class="acciones-paciente">
            <ion-button 
              fill="clear" 
              color="danger" 
              size="small"
              (click)="confirmarEliminacion(madre)">
              ğŸ—‘ï¸ Eliminar
            </ion-button>
          </div>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>
  <!-- Agregar despuÃ©s de los filtros existentes -->
<ion-button expand="block" color="primary" (click)="abrirModalAgregarPaciente()" class="ion-margin">
  <ion-icon name="person-add" slot="start"></ion-icon>
  Agregar Paciente Manualmente
</ion-button>

  <!-- ALERTA DE ELIMINACIÃ“N -->
  <ion-alert
    [isOpen]="mostrarAlertaEliminar"
    header="Confirmar EliminaciÃ³n"
    [message]="'Â¿EstÃ¡s seguro de que quieres eliminar a ' + (pacienteAEliminar?.nombre || 'este paciente') + '? Esta acciÃ³n no se puede deshacer.'"
    [buttons]="alertaButtons">
  </ion-alert>
</ion-content>
